# YJPL 前端生成界面智能体综合指南

## 目录
1. [概述](#概述)
2. [模板选择策略](#模板选择策略)
3. [代码结构规范](#代码结构规范)
4. [数据模型设计](#数据模型设计)
5. [模板扩展技巧](#模板扩展技巧)
6. [常见场景实现](#常见场景实现)
7. [组件库完整参考](#组件库完整参考)
8. [QZZ 表格组件使用指南](#qzz-表格组件使用指南)
9. [中台组件集成](#中台组件集成)
10. [Mock数据规则](#mock数据规则)
11. [性能优化建议](#性能优化建议)
12. [AI 提示词模板](#ai-提示词模板)

---

## 概述

本文档是 YJPL 框架前端开发的通用知识库，基于框架的两个核心模板、完整的组件库、中台组件和 Mock 机制总结而成，旨在指导如何使用 AI 高效生成符合规范的前端界面代码。

### 核心模板
- **list-template.yjpl**：列表查询模板，用于展示数据列表、支持查询筛选和多视图切换
- **page/ywdj/index.yjpl**：业务单据模板，用于展示业务单据详情、支持表单、表格、审批流程等

### 适用范围
本文档适用于所有使用 YJPL 框架开发的前端项目，包括但不限于：
- 数据列表和查询页面
- 业务单据和详情页面
- 对话框和表单页面
- 配置和设置页面
- 企业应用中台系统

### 框架版本
- 当前版本: 8.5.0
- 重要变更: 移除element-ui依赖，优化资源大小

---

## 模板选择策略

### 1. 何时使用 list-template.yjpl

**适用场景：**
- 需要展示数据列表的页面
- 需要查询/筛选功能的页面
- 需要多视图切换的页面（表格、列表、卡片、图表）
- 需要树形导航的页面

**特征识别：**
```
✓ 有查询面板
✓ 有表格/列表展示
✓ 有工具栏按钮
✓ 可能有树形导航
✓ 支持多种视图
```

**典型特征：**
- 有查询/筛选面板
- 有表格或列表展示
- 有工具栏按钮
- 可能有树形导航
- 支持多种视图切换

### 2. 何时使用 page/ywdj/index.yjpl

**适用场景：**
- 业务单据详情页面
- 需要表单 + 表格组合的页面
- 需要审批流程展示的页面
- 需要附件管理的页面

**特征识别：**
```
✓ 有表单区域
✓ 有子表格
✓ 有审批/流程信息
✓ 有附件区域
✓ 有侧边栏
✓ 有锚点导航
```

**典型特征：**
- 有表单区域
- 有子表格
- 有审批/流程信息
- 有附件区域
- 有侧边栏
- 有锚点导航

### 3. 何时不使用模板

**自定义开发场景：**
- 完全自定义的首页/仪表板
- 大屏展示页面
- 特殊业务流程页面

**典型场景：**
- 完全自定义的首页/仪表板
- 大屏展示页面
- 特殊业务流程页面
- 不符合标准模板结构的页面

---

## 代码结构规范

### 1. 标准文件组织

```
your-page/
├── index.yjpl              # 主模板文件（extends 模板）
├── Business.ts             # 业务逻辑类
├── Model.ts                # 数据模型（包含 metaModel、dataModel、stateModel）
└── components/             # 子组件（可选）
    ├── component1.yjpl
    └── component2.yjpl
```

### 2. 三层数据模型（分离在 Model.ts 中）

**Model.ts 结构**
```typescript
import { YJState } from 'yjpl-core';

// metaModel - 页面配置（静态）
export const metaModel = {
  title: '页面标题',
  query: [
    {
      name: 'fieldName',
      label: '字段标签',
      dataType: 'string',
      placeholder: '请输入'
    }
  ],
  grid: {
    colNames: ['列1', '列2'],
    colModels: [
      { name: 'field1', caption: '列1' },
      { name: 'field2', caption: '列2' }
    ]
  },
  btns: [
    { name: 'add', text: '新增' },
    { name: 'edit', text: '编辑' },
    { name: 'delete', text: '删除' }
  ]
};

// dataModel - 业务数据（动态）
export const dataModel = {
  query: {},         // 查询条件
  grid: [],          // 表格数据
  tree: [],          // 树形数据
  pageTotal: 0       // 分页总数
};

// stateModel - 状态管理（控制）
export const stateModel = {
  add: YJState.STATE.DEFAULT,
  edit: YJState.STATE.DEFAULT,
  delete: YJState.STATE.DISABLED
};

export default {
  metaModel,
  dataModel,
  stateModel
};
```

**详细说明**：
- **metaModel（页面配置）- 静态** - 页面结构、字段定义、按钮配置等，不会在运行时改变
- **dataModel（业务数据）- 动态** - 实际的业务数据、查询条件、表格数据等，会根据用户操作改变
- **stateModel（状态管理）- 控制** - 组件状态（禁用、加载、隐藏等），使用 YJState.STATE 枚举值

### 3. Business 类规范

```typescript
import { YJBusiness, YJState } from 'yjpl-core';
import Model from './Model';

export default class YourPageBusiness extends YJBusiness {
  constructor() {
    super();
    // 从 Model.ts 中引入数据模型
    this.dataModel = Model.dataModel;
    this.stateModel = Model.stateModel;
  }

  // 获取初始查询数据
  async getQueryData() {
    // 返回查询面板的初始值
    return {
      // fieldName: defaultValue
    };
  }

  // 获取树形数据
  async getTreeData() {
    // 返回树形结构数据
    return [];
  }

  // 获取表格数据
  async getGridData(pageSize?: number, pageIndex?: number) {
    // 调用后端 API 获取表格数据
    // 返回数组格式的数据
    return [];
  }

  // 获取总记录数
  async getTotalRecord() {
    // 返回分页总数
    return 0;
  }

  // 获取所有数据（供 index.yjpl 使用）
  getData() {
    return {
      metaModel: Model.metaModel,
      dataModel: this.dataModel,
      stateModel: this.stateModel
    };
  }
}
```

**关键点**：
- Business 类在构造函数中初始化 dataModel 和 stateModel（从 Model.ts 引入）
- 提供 getData() 方法返回所有模型数据供 index.yjpl 使用
- 实现异步方法获取各类数据（查询、树、表格等）

### 4. index.yjpl 文件规范

**⚠️ 重要提示：必须在 `<script>` 标签中添加 `lang="ts"` 属性**

当在 `.yjpl` 文件中使用 TypeScript 类型注解时，必须在 `<script>` 标签上声明 `lang="ts"`，否则编译器无法识别 TypeScript 语法。

```xml
<!-- ❌ 错误的方式 - 会导致编译错误 -->
<template>
  <page extends="yjpl-template/business/list-template.yjpl">
  </page>
</template>

<script>
export default class MyPage {
  handleSort(column: string, order: string) {  // ❌ 编译错误：无法识别类型注解
    // ...
  }
}
</script>

<!-- ✅ 正确的方式 -->
<template>
  <page extends="yjpl-template/business/list-template.yjpl">
  </page>
</template>

<script lang="ts">
export default class MyPage {
  handleSort(column: string, order: string) {  // ✅ 正确：能够识别类型注解
    // ...
  }
}
</script>
```

**标准的 .yjpl 文件结构：**

```xml
<template>
  <page extends="yjpl-template/business/list-template.yjpl">
    <!-- 使用 plugins 进行模板扩展 -->
    <plugins type="append" target=".query-toolbar">
      <!-- 自定义内容 -->
    </plugins>
  </page>
</template>

<script lang="ts">
import ListTemplate from 'yjpl-template/business/list-template.yjpl';
import Business from './Business';

export default class MyPage extends ListTemplate {
  constructor() {
    super();
    this.bs = new Business();
  }

  data() {
    return {
      ...this.bs.getData(),
      eventsModel: {
        // 事件绑定配置
      }
    };
  }

  async created() {
    // 初始化数据
    this.dataModel.query = await this.bs.getQueryData();
    this.dataModel.tree = await this.bs.getTreeData();
    this.dataModel.grid = await this.bs.getGridData();
  }

  methods() {
    return {
      // 事件处理方法
    };
  }

  watch() {
    return {
      // 监听器配置
    };
  }
}
</script>

<style lang="scss" scoped>
/* 样式 */
</style>
```

**关键点**：
- 必须继承模板类（如 ListTemplate）
- 在 data() 中使用 `...this.bs.getData()` 展开 Business 返回的数据
- 在 created() 生命周期中初始化数据
- 使用 eventsModel 配置事件绑定
- 使用 plugins 进行模板扩展

**常见错误及解决方案：**

| 错误信息 | 原因 | 解决方案 |
|---------|------|--------|
| `Syntax Error: Unexpected token, expected ","` | 缺少 `lang="ts"` 属性 | 在 `<script>` 标签中添加 `lang="ts"` |
| `Cannot find module 'yjpl-core'` | TypeScript 类型定义缺失 | 确保项目安装了 `@types/yjpl-core` |
| `Property 'xxx' does not exist` | 类型检查失败 | 检查属性名称和类型定义 |
| `this.bs is undefined` | Business 类未正确初始化 | 在 constructor 中初始化 `this.bs = new Business()` |
| `metaModel is undefined` | 数据未正确展开 | 确保在 data() 中使用 `...this.bs.getData()` |


---

## 数据模型设计

### 1. 查询字段配置

```typescript
query: [
  {
    name: 'fieldName',           // 字段名（必填）
    label: '字段标签',           // 显示标签
    dataType: 'text',            // 数据类型
    type: 'text',                // 输入类型
    placeholder: '请输入',       // 占位符
    required: false,             // 是否必填
    disabled: false,             // 是否禁用
    visible: true,               // 是否可见
    defaultValue: '',            // 默认值
    options: [],                 // 选项（select/radio/checkbox）
    
    // 特殊类型配置
    format: 'yyyy-MM-dd',        // 日期格式
    valueFormat: 'yyyy-MM-dd',   // 值格式
    filterable: true,            // 是否可搜索
    clearable: true,             // 是否可清空
    multiple: false,             // 是否多选
    
    // 级联配置
    children: [...]              // 子字段
  }
]
```

### 2. 表格列配置

```typescript
grid: {
  columns: [
    {
      key: 'id',                 // 列键
      label: 'ID',               // 列标签
      width: 80,                 // 列宽
      type: 'text',              // 列类型
      sortable: true,            // 是否可排序
      filterable: true,          // 是否可筛选
      align: 'center',           // 对齐方式
      formatType: 'money',       // 格式化类型
      scale: 2                   // 小数位数
    }
  ],
  pageSize: 20,                  // 每页条数
  pageSizes: [10, 20, 50, 100], // 分页选项
  showPagination: true,          // 显示分页
  showCheckbox: true,            // 显示复选框
  showIndex: true,               // 显示序号
  height: 'auto',                // 表格高度
  striped: true,                 // 斑马纹
  border: true                   // 边框
}
```

### 3. 按钮配置

```typescript
btns: [
  {
    id: 'add',                   // 按钮 ID
    label: '新增',               // 按钮文本
    icon: 'yj-p-add',            // 图标
    type: 'primary',             // 按钮类型
    disabled: false,             // 是否禁用
    visible: true,               // 是否可见
    action: 'add'                // 关联动作
  }
]
```

---

## 模板扩展技巧

### 1. 使用 plugins 修改模板

**四种操作类型：**

```xml
<!-- 1. 替换（replace）- 完全替换目标内容 -->
<plugins type="replace" target=".query-toolbar">
  <div slot="toolbar" class="query-toolbar">
    <!-- 自定义工具栏 -->
  </div>
</plugins>

<!-- 2. 追加（append）- 在目标后追加内容 -->
<plugins type="append" target=".query-body">
  <custom-component></custom-component>
</plugins>

<!-- 3. 插入（insert）- 在目标前插入内容 -->
<plugins type="insert" target=".query-grid">
  <div>插入的内容</div>
</plugins>

<!-- 4. 移除（remove）- 移除目标元素 -->
<plugins type="remove" target=".bill-user"></plugins>
```

**常用目标选择器：**

| 选择器 | 说明 | 模板 |
|--------|------|------|
| `.query-header` | 头部区域 | list-template |
| `.query-search-panel` | 查询面板 | list-template |
| `.query-toolbar` | 工具栏 | list-template |
| `.query-grid-body` | 表格区域 | list-template |
| `.query-body` | 主体区域 | list-template |
| `.bill-title` | 标题区域 | ywdj |
| `.bill-form` | 表单区域 | ywdj |
| `.bill-info` | 详情区域 | ywdj |
| `.bill-upload` | 附件区域 | ywdj |
| `.bill-workflow` | 流程区域 | ywdj |
| `.bill-footer` | 底部工具栏 | ywdj |

### 2. 实际应用示例

**示例 1：替换工具栏**
```xml
<template>
  <page extends="yjpl-template/business/list-template.yjpl">
    <plugins type="replace" target=".query-toolbar">
      <div slot="toolbar" class="query-toolbar">
        <button v-for="item of metaModel.functionButton" 
                @click="handleClick(item)">
          {{item.title}}
        </button>
      </div>
    </plugins>
  </page>
</template>
```

**示例 2：移除查询面板**
```xml
<plugins type="remove" target=".query-search-panel"></plugins>
```

**示例 3：追加自定义组件**
```xml
<plugins type="append" target=".bill-upload">
  <upload-panel></upload-panel>
</plugins>
```

---

## 常见场景实现

### 场景 1：标准列表查询页面

**需求：** 显示数据列表，支持查询、排序、分页

**实现步骤：**

1. **创建 Model.ts**
```typescript
import { YJState } from 'yjpl-core';

export const metaModel = {
  title: '数据列表',
  query: [
    { 
      name: 'name', 
      label: '名称', 
      dataType: 'string',
      placeholder: '请输入名称'
    },
    { 
      name: 'status', 
      label: '状态', 
      dataType: 'combobox',
      options: [
        { label: '启用', value: 1 }, 
        { label: '禁用', value: 0 }
      ]
    }
  ],
  grid: {
    colNames: ['ID', '名称', '状态'],
    colModels: [
      { name: 'id', caption: 'ID', width: 80 },
      { name: 'name', caption: '名称', width: 150 },
      { name: 'status', caption: '状态', width: 100 }
    ],
    pageSize: 20,
    pager: true
  },
  btns: [
    { name: 'add', text: '新增', type: 'primary' },
    { name: 'edit', text: '编辑' },
    { name: 'delete', text: '删除' }
  ]
};

export const dataModel = {
  query: {},
  grid: [],
  pageTotal: 0
};

export const stateModel = {
  add: YJState.STATE.DEFAULT,
  edit: YJState.STATE.DEFAULT,
  delete: YJState.STATE.DEFAULT
};

export default { metaModel, dataModel, stateModel };
```

2. **创建 Business.ts**
```typescript
import { YJBusiness } from 'yjpl-core';
import Model from './Model';

export default class ListBusiness extends YJBusiness {
  constructor() {
    super();
    this.dataModel = Model.dataModel;
    this.stateModel = Model.stateModel;
  }

  // 获取初始查询数据
  async getQueryData() {
    return {};
  }

  // 获取表格数据
  async getGridData(pageSize?: number, pageIndex?: number) {
    // 调用后端 API 获取数据
    // const response = await api.getList({
    //   pageSize,
    //   pageIndex,
    //   ...this.dataModel.query
    // });
    // return response.data;
    
    // Mock 数据示例
    return [
      { id: 1, name: '项目1', status: 1 },
      { id: 2, name: '项目2', status: 0 },
      { id: 3, name: '项目3', status: 1 }
    ];
  }

  // 获取总记录数
  async getTotalRecord() {
    return 3;
  }

  // 获取所有数据供 index.yjpl 使用
  getData() {
    return {
      metaModel: Model.metaModel,
      dataModel: this.dataModel,
      stateModel: this.stateModel
    };
  }
}
```

3. **创建 index.yjpl**
```xml
<template>
  <page extends="yjpl-template/business/list-template.yjpl">
  </page>
</template>

<script lang="ts">
import ListTemplate from 'yjpl-template/business/list-template.yjpl';
import Business from './Business';

export default class ListPage extends ListTemplate {
  constructor() {
    super();
    this.bs = new Business();
  }

  data() {
    return {
      ...this.bs.getData(),
      eventsModel: {
        add: {
          click: this.handleAdd
        },
        edit: {
          click: this.handleEdit
        },
        delete: {
          click: this.handleDelete
        }
      }
    };
  }

  async created() {
    // 初始化数据
    this.dataModel.query = await this.bs.getQueryData();
    this.dataModel.grid = await this.bs.getGridData();
    this.dataModel.pageTotal = await this.bs.getTotalRecord();
  }

  mounted() {
    // 设置分页总数
    if (this.$refs.grid && this.$refs.grid.ui) {
      this.$refs.grid.ui.setTotalRecord(this.dataModel.pageTotal);
    }
  }

  methods() {
    return {
      query() {
        // 查询方法
        this.$refs.grid.ui.refresh();
      },
      reset() {
        // 重置方法
        this.dataModel.query = {};
      },
      handleAdd() {
        this.$message('新增功能');
      },
      handleEdit() {
        this.$message('编辑功能');
      },
      handleDelete() {
        this.$message('删除功能');
      }
    };
  }

  watch() {
    return {
      'dataModel.query': {
        handler() {
          // 查询条件变化时触发查询
          this.query();
        },
        deep: true
      }
    };
  }
}
</script>
```

### 场景 2：多视图列表页面

**需求：** 支持表格、列表、卡片三种视图切换

**关键配置：**
```typescript
grid: {
  defaultShow: 'grid',      // 默认视图
  showGrid: true,           // 显示表格
  showList: true,           // 显示列表
  showCard: true,           // 显示卡片
  
  // 卡片视图配置
  cardOption: {
    formatOption: {
      title: 'name',        // 标题字段
      subTitle: 'date',     // 副标题字段
      money: 'amount',      // 金额字段
      description: 'desc'   // 描述字段
    }
  }
}
```

### 场景 3：业务单据详情页面

**需求：** 显示单据信息、子表、审批流程

**实现步骤：**

1. **创建 pageModel.ts**
```typescript
export default {
  title: '订单详情',
  code: 'ORD-2024-001',
  date: '2024-12-04',
  cols: 4,
  
  form: [
    { name: 'orderNo', label: '订单号', dataType: 'string', required: true },
    { name: 'customerName', label: '客户名称', dataType: 'string' }
  ],
  
  grid: {
    columns: [
      { key: 'productName', label: '产品名称', width: 150 },
      { key: 'quantity', label: '数量', width: 80 }
    ]
  },
  
  toolbar: [
    { label: '保存', type: 'primary' },
    { label: '提交', type: 'primary' },
    { label: '取消' }
  ],
  
  anchor: [
    { title: '基础信息', id: 'form' },
    { title: '详情信息', id: 'info' },
    { title: '附件文档', id: 'upload' },
    { title: '审批流程', id: 'workflow' }
  ]
}
```

2. **创建 index.yjpl**
```xml
<template>
  <page extends="yjpl-template/page/ywdj/index.yjpl">
    <!-- 自定义侧边栏 -->
    <plugins type="replace" target=".bill-aside">
      <custom-aside></custom-aside>
    </plugins>
    
    <!-- 自定义审批流程 -->
    <plugins type="replace" target=".bill-leader">
      <workflow-panel></workflow-panel>
    </plugins>
  </page>
</template>
```

### 场景 4：带树形导航的列表

**需求：** 左侧树形导航，右侧表格展示

**关键配置：**
```typescript
metaModel: {
  showTree: true,
  tree: {
    nodeKey: 'id',
    label: 'name',
    children: 'children',
    defaultExpandAll: true
  }
}
```

**事件处理：**
```typescript
methods() {
  return {
    treeSelect(node) {
      // 树节点选择事件
      this.dataModel.query.treeId = node.id;
      this.query();
    }
  };
}
```

### 场景 5：对话框表单

**需求：** 弹出对话框进行数据编辑

**实现：**
```xml
<template>
  <page>
    <button @click="showDialog = true">打开对话框</button>
    
    <dialog title="编辑" :visible.sync="showDialog">
      <yj-container v-model="formData" :data="formConfig"></yj-container>
      <span slot="footer">
        <button @click="showDialog = false">取消</button>
        <button type="primary" @click="handleSave">保存</button>
      </span>
    </dialog>
  </page>
</template>
```

---

## 组件库完整参考

### 组件查询指南

当遇到不清楚的组件时，请按照以下步骤查询：

1. **查看本章节的组件分类** - 快速定位组件所属类别
2. **查看平台组件-总索引.md** - 获取组件的详细参数说明
3. **查看平台组件md文档/** - 查找具体组件的使用文档

**文件映射关系：**
- 基础组件 → `KNOWLEDGE/PUBLIC/平台组件md文档/components/basic/`
- 表单组件 → `KNOWLEDGE/PUBLIC/平台组件md文档/components/form/`
- 数据展示 → `KNOWLEDGE/PUBLIC/平台组件md文档/components/data/`
- 业务组件 → `KNOWLEDGE/PUBLIC/平台组件md文档/components/business/`
- 容器组件 → `KNOWLEDGE/PUBLIC/平台组件md文档/components/container/`
- 反馈组件 → `KNOWLEDGE/PUBLIC/平台组件md文档/components/feedback/`
- 导航组件 → `KNOWLEDGE/PUBLIC/平台组件md文档/components/navigation/`
- 其他组件 → `KNOWLEDGE/PUBLIC/平台组件md文档/components/others/`

### 基础组件 (6个)
- **Button** - 按钮组件 → `components/basic/button.md`
- **Icon** - 图标组件 → `components/basic/icon.md`
- **Link** - 链接组件 → `components/basic/link.md`
- **Layout** - 布局组件 → `components/basic/layout.md`
- **Container** - 容器组件 → `components/basic/container.md`
- **Transition** - 过渡动画组件 → `components/basic/transition.md`

### 表单组件 (16个)
- **Input** - 输入框 → `components/form/input.md`
- **InputNumber** - 数字输入框 → `components/form/input-number.md`
- **Select** - 选择器 → `components/form/select.md`
- **Cascader** - 级联选择器 → `components/form/cascader.md`
- **DatePicker** - 日期选择器 → `components/form/date-picker.md`
- **TimePicker** - 时间选择器 → `components/form/time-picker.md`
- **Checkbox** - 复选框 → `components/form/checkbox.md`
- **Radio** - 单选框 → `components/form/radio.md`
- **Switch** - 开关 → `components/form/switch.md`
- **Slider** - 滑块 → `components/form/slider.md`
- **ColorPicker** - 颜色选择器 → `components/form/color-picker.md`
- **Upload** - 文件上传 → `components/form/upload.md`
- **Form** - 表单容器 → `components/form/form.md`
- **EntitySelect** - 实体选择器 → `components/form/entity-select.md`
- **RangeNumber** - 范围数字输入 → `components/form/range-number.md`
- **YjCondition** - 条件组件 → `components/form/yj-condition.md`

### 数据展示 (8个)
- **Table** - 数据表格 → `components/data/table.md`
- **Tree** - 树形组件 → `components/data/tree.md`
- **Pagination** - 分页器 → `components/data/pagination.md`
- **Avatar** - 头像组件 → `components/data/avatar.md`
- **Tag** - 标签组件 → `components/data/tag.md`
- **Badge** - 徽章组件 → `components/feedback/badge.md`
- **Timeline** - 时间线组件 → `components/others/timeline.md`
- **SelectList** - 选择列表 → `components/data/select-list.md`

### 业务组件 (14个)
- **Export** - 导出功能 → `components/business/export.md`
- **Import** - 导入功能 → `components/business/import.md`
- **SearchPanel** - 搜索面板 → `components/business/search-panel.md`
- **TableTools** - 表格工具栏 → `components/business/table-tools.md`
- **UploadPanel** - 上传面板 → `components/business/upload-chunk.md`
- **YjButtonList** - 按钮列表 → `components/business/yj-button-list.md`
- **YjContainerCard** - 容器卡片 → `components/business/yj-container-card.md`
- **YjContainer** - 容器组件 → `components/business/yj-container.md`
- **YjTransfer** - 穿梭框 → `components/business/yj-transfer.md`
- **Calculator** - 计算器 → `components/business/calculator.md`
- **Magnifier** - 放大镜 → `components/business/magnifier.md`
- **QrBarCode** - 二维码/条形码 → `components/business/qr-bar-code.md`
- **WaterMark** - 水印 → `components/others/water-mark.md`
- **ErrorPage** - 错误页面 → `components/business/error-page.md`

### 容器组件 (11个)
- **Dialog** - 对话框 → `components/container/dialog.md`
- **Drawer** - 抽屉 → `components/container/drawer.md`
- **Card** - 卡片 → `components/container/card.md`
- **Tabs** - 标签页 → `components/container/tabs.md`
- **Steps** - 步骤条 → `components/container/steps.md`
- **Collapse** - 折叠面板 → `components/others/collapse.md`
- **Section** - 分区组件 → `components/container/section.md`
- **Anchor** - 锚点 → `components/container/anchor.md`
- **Title** - 标题 → `components/container/title.md`
- **FoldBar** - 折叠栏 → `components/container/foldbar.md`
- **YjDialog** - 增强对话框 → `components/container/yj-dialog.md`

### 反馈组件 (11个)
- **Message** - 消息提示 → `components/feedback/message.md`
- **MessageBox** - 消息框 → `components/feedback/message-box.md`
- **Notification** - 通知 → `components/feedback/notification.md`
- **Alert** - 警告框 → `components/feedback/alert.md`
- **Loading** - 加载动画 → `components/feedback/loading.md`
- **Progress** - 进度条 → `components/feedback/progress.md`
- **Tooltip** - 工具提示 → `components/feedback/tooltip.md`
- **Popover** - 弹出框 → `components/feedback/popover.md`
- **PopConfirm** - 确认弹框 → `components/others/pop-confirm.md`
- **CornerMark** - 角标 → `components/feedback/corner-mark.md`
- **YjMessage** - 增强消息提示 → `components/feedback/yj-message.md`

### 导航组件 (5个)
- **Menu** - 菜单 → `components/navigation/menu.md`
- **Breadcrumb** - 面包屑 → `components/navigation/breadcrumb.md`
- **PageTabs** - 页面标签 → `components/navigation/page-tabs.md`
- **DropDown** - 下拉菜单 → `components/navigation/drop-down.md`
- **PageHeader** - 页面头部 → `components/navigation/page-header.md`

### 其他组件 (6个)
- **Carousel** - 轮播图 → `components/others/carousel.md`
- **Image** - 图片 → `components/others/image.md`
- **Divider** - 分割线 → `components/others/divider.md`
- **BackTop** - 返回顶部 → `components/others/backtop.md`
- **InfiniteScroll** - 无限滚动 → `components/others/infinite-scroll.md`
- **SpreadJS** - 电子表格 → `components/others/spreadjs.md`

---

## QZZ 表格组件使用指南

QZZ 是一套功能强大的表格组件库，包含 **QzzGrid**（编辑表格）和 **QzzQueryGrid**（查询表格）两个核心组件，提供丰富的数据展示、编辑、查询等功能。

### 快速开始

#### QzzGrid - 编辑表格

```html
<template>
  <div style="height: 300px">
    <qzz-grid :option="gridOption" v-model="gridData" ref="grid"></qzz-grid>
  </div>
</template>

<script>
export default {
  data() {
    return {
      gridOption: {
        Align: 'alClient',
        height: 300,
        multiselect: true,
        colNames: ['名称', '编码', '日期', '金额'],
        colModels: [
          { name: 'name' },
          { name: 'code' },
          { name: 'date', editType: 'date' },
          { name: 'amount', editType: 'number', scale: 2, sum: true }
        ]
      },
      gridData: [
        { name: '项目1', code: '001', amount: 10000 },
        { name: '项目2', code: '002', amount: 20000 }
      ]
    };
  }
};
</script>
```

#### QzzQueryGrid - 查询表格

```html
<template>
  <div style="height: 300px">
    <qzz-query-grid :option="gridOption" v-model="gridData" ref="grid"></qzz-query-grid>
  </div>
</template>

<script>
export default {
  data() {
    return {
      gridOption: {
        Align: 'alClient',
        height: 300,
        colNames: ['名称', '编码', '日期', '金额'],
        colModels: [
          { name: 'name' },
          { name: 'code' },
          { name: 'date', dataType: 'date' },
          { name: 'amount', dataType: 'number', scale: 2, sum: true }
        ]
      },
      gridData: [
        { name: '项目1', code: '001', amount: 10000 },
        { name: '项目2', code: '002', amount: 20000 }
      ]
    };
  }
};
</script>
```

### 核心功能

#### 1. 列配置（colModels）

| 属性 | 说明 | 类型 | 常用值 |
|------|------|------|--------|
| `name` | 字段名称 | String | - |
| `editType` | 编辑类型 | String | `text`, `number`, `date`, `comboBox`, `checkBox`, `buttonEdit` |
| `dataType` | 数据类型 | String | `string`, `number`, `date`, `boolean` |
| `width` | 列宽 | Number | - |
| `hidden` | 是否隐藏 | Boolean | `true`, `false` |
| `editable` | 是否可编辑 | Boolean | `true`, `false` |
| `required` | 是否必填 | Boolean | `true`, `false` |
| `frozen` | 是否冻结 | Boolean | `true`, `false` |
| `align` | 对齐方式 | String | `left`, `center`, `right` |
| `sum` | 是否合计 | Boolean | `true`, `false` |
| `scale` | 小数精度 | Number | 如 `2` 表示两位小数 |
| `validate` | 验证规则 | String | `email`, `phone` 等 |
| `data` | 下拉数据 | Array | `[{id: '1', text: '选项1'}]` |
| `showTime` | 日期显示时间 | Boolean | `true`, `false` |
| `minDate` | 最小日期 | Date | - |
| `maxDate` | 最大日期 | Date | - |
| `minValue` | 最小值 | Number | - |
| `maxValue` | 最大值 | Number | - |
| `length` | 输入长度限制 | Number | - |
| `filter` | 是否可过滤 | Boolean | `true`, `false` |

#### 2. 表格配置（option）

| 属性 | 说明 | 类型 | 默认值 |
|------|------|------|--------|
| `Align` | 对齐方式 | String | `alClient` 自适应容器 |
| `height` | 表格高度 | Number | 必填 |
| `width` | 表格宽度 | Number | - |
| `colNames` | 列标题数组 | Array | 必填 |
| `colModels` | 列配置数组 | Array | 必填 |
| `multiselect` | 是否多选 | Boolean | `false` |
| `rownumbers` | 显示序号列 | Boolean | `true` |
| `pager` | 显示分页 | Boolean | `false` |
| `pageSize` | 每页条数 | Number | `10` |
| `total` | 显示合计行 | Boolean | `false` |
| `subtotal` | 显示小计行 | Boolean | `false` |
| `sort` | 显示排序 | Boolean | `true` |
| `filter` | 显示过滤 | Boolean | `true` |
| `treeGrid` | 是否树表 | Boolean | `false` |
| `virtual` | 懒加载 | Boolean | `false` |
| `cellEdit` | 列可编辑 | Boolean | `true` |
| `hidePopMenu` | 隐藏右键菜单 | Boolean | `false` |
| `colDesign` | 显示列设置 | Boolean | `true` |

### 常用方法

#### 数据操作

```javascript
const grid = this.$refs.grid.ui;

// 获取表格数据
const data = grid.value();

// 设置表格数据
grid.value([{ name: '项目1', amount: 1000 }]);

// 添加行
grid.append();

// 插入行（在当前行前插入）
grid.insert();

// 删除当前行
grid.delRecord();

// 删除所有数据
grid.deleteAll();

// 获取变更集（新增、修改、删除的数据）
const changeSet = grid.getChangeSet();

// 获取选中行数据
const selectedData = grid.getSelectedRowData();
```

#### 行列操作

```javascript
// 获取当前行的字段值
const value = grid.getValue('fieldName');

// 设置当前行的字段值
grid.setValue('fieldName', 'value');

// 设置列只读
grid.setColReadOnly('fieldName', true);

// 隐藏列
grid.hideCol(['fieldName1', 'fieldName2']);

// 显示列
grid.showCol(['fieldName1', 'fieldName2']);

// 设置列对齐
grid.setColAlign('fieldName', 'center');

// 获取列配置
const colModel = grid.getColModel('fieldName');
```

#### 表格状态

```javascript
// 设置只读
grid.setReadOnly(true);

// 获取只读状态
const isReadOnly = grid.isReadOnly();

// 刷新表格
grid.refresh();

// 设置表格高度
grid.setHeight(500);

// 设置表格宽度
grid.setWidth(800);

// 获取数据条数
const count = grid.getRecordCount();

// 全选
grid.selectAll();

// 取消全选
grid.cancelSelectRow();
```

#### 分页操作

```javascript
// 设置每页条数
grid.setPageSize(20);

// 获取每页条数
const pageSize = grid.getPageSize();

// 设置页码
grid.setPageIndex(2);

// 获取页码
const pageIndex = grid.getPageIndex();

// 获取页数
const pageCount = grid.getPageCount();

// 第一页
grid.firstPage();

// 最后一页
grid.lastPage();

// 上一页
grid.priorPage();

// 下一页
grid.nextPage();
```

### 常用事件

#### 行事件

```javascript
grid.bind('onRowChanged', function() {
  // 行变更时触发
  console.log('当前行:', this.getValue('name'));
});

grid.bind('beforeSelectRow', function(oldNode, newNode) {
  // 行选择前触发，返回false可阻止选择
  return true;
});

grid.bind('onSelectRow', function(cNode, selectState, fieldName) {
  // 行选择时触发
  console.log('选择状态:', selectState);
});
```

#### 编辑事件

```javascript
grid.bind('onBeforeEdit', function(dataType, fieldName, value, text, colModel, node) {
  // 编辑前触发，返回false可阻止编辑
  return true;
});

grid.bind('onAfterEdit', function(dataType, fieldName, value, text, colModel, cNode) {
  // 编辑后触发
  console.log('编辑字段:', fieldName, '新值:', value);
});

grid.bind('onEditing', function(colModel, oldValue, newValue, cellOption, cNode) {
  // 编辑中触发
  return true;
});
```

### 高级用法

#### 1. 单元格格式化

```javascript
mounted() {
  const grid = this.$refs.grid.ui;
  
  // 格式化金额列
  grid.bind('onFormat_amount', function(node, fieldName, dataType, value, colModel) {
    if (value) {
      return '¥' + parseFloat(value).toFixed(2);
    }
    return '';
  });
  
  // 格式化状态列
  grid.bind('onFormat_status', function(node, fieldName, dataType, value, colModel) {
    const statusMap = { '1': '启用', '0': '禁用' };
    return statusMap[value] || '';
  });
}
```

#### 2. 条件编辑控制

```javascript
mounted() {
  const grid = this.$refs.grid.ui;
  
  grid.bind('onCanEditing', function(ds, fn, state) {
    // 如果状态为禁用，则不允许编辑
    if (ds.getValue('status') === '0') {
      return false;
    }
    return state;
  });
}
```

#### 3. 表达式运算

```javascript
mounted() {
  const grid = this.$refs.grid.ui;
  
  // 添加单元格运算表达式（合计 = 数量 × 单价）
  grid.addExpress('total', 'id', '', {
    exp: 'qty*price',
    caption: '合计'
  });
  
  // 执行计算
  grid.caculate();
}
```

### 性能优化建议

1. **大数据量使用虚拟滚动**
   ```javascript
   gridOption: {
     virtual: true,  // 启用懒加载
     pageSize: 50    // 合理设置每页条数
   }
   ```

2. **避免频繁刷新**
   ```javascript
   grid.beginUpdate();
   // 执行多个操作
   grid.endUpdate(true); // 最后统一刷新
   ```

3. **合理使用冻结列**
   ```javascript
   colModels: [
     { name: 'id', frozen: true },  // 只冻结必要的列
     { name: 'name', frozen: true }
   ]
   ```

4. **按需加载数据**
   ```javascript
   gridOption: {
     pager: true,
     pageSize: 20  // 分页加载而不是一次性加载所有数据
   }
   ```

---

## 中台组件集成

### 1. 业务中台组件

#### 核心功能
- 提供统一的业务流程处理能力
- 支持模板继承与UI解耦
- 按需加载，精确到方法级别

#### 主要模块
- **yjpl-template**: 模板系统（单据、查询、列表、操作等）
- **yjpl-ui**: UI组件库（表单、表格、对话框等）
- **yjpl-qzz**: 高性能表格组件
- **yjpl-core**: 核心框架
- **yjpl-utils**: 工具类库

#### 完整引入
```typescript
import Yjpl from 'yjpl';
import YjplUI from 'yjpl-ui';
import 'yjpl-ui/lib/theme-chalk/index.css';
import App from './App.yjpl';
import i18n from './i18n';

Yjpl.use(YjplUi, {
  i18n: (key: string, opts: any) => i18n.t(key, opts)
});

new Yjpl({
  i18n,
  render: h => h(App)
}).$mount('#app');
```

#### 按需引入
```bash
npm install babel-plugin-component -D
```

配置.babelrc:
```json
{
  "plugins": [
    [
      "component",
      {
        "libraryName": "yjpl-ui",
        "styleLibraryName": "theme-chalk"
      }
    ]
  ]
}
```

### 2. 中台主数据选择控件

#### 2.1 中台组件通用使用模式

所有中台选择控件（币种、枚举、管理对象、地区、业务分类、单位、用户等）都遵循统一的使用模式：

**组件引入模式**：
```javascript
// 1. 在 index.yjpl 中引入组件
import ComponentName from 'package-path/component.yjpl';

// 2. 在组件中注册
components() {
  return {
    'component-name': ComponentName
  };
}

// 3. 表格编辑器引入（在 Business.ts 中）
import ComponentEdit from 'package-path/component.grid.edit.js';
```

**在 MetaModel 中使用**：
```javascript
query: [
  {
    name: 'fieldName',
    dataType: 'component-type',
    label: '字段标签',
    value: [],
    multiple: true,
    vipAddress: '/necp/mapp/metamodel'
  }
]
```

**在 QZZ 表格中使用**：
```javascript
grid: {
  colModels: [
    {
      name: 'fieldName',
      index: 'fieldName',
      width: 150,
      editType: ComponentEdit,
      ecp: true
    }
  ]
}
```

#### 2.2 常用中台选择控件

| 控件名称 | 功能描述 | 常用参数 |
|---------|---------|---------|
| **币种选择** | 选择币种信息 | v-model, multiple, vipAddress, ecp |
| **对象分类** | 选择对象分类 | v-model, itemcode, multiple, filterQx |
| **枚举选择** | 选择枚举值 | v-model, entityTypeId, type, multiple |
| **管理对象** | 选择管理对象 | v-model, dxlxId, multiple, filterOption |
| **地区选择** | 选择地区信息 | v-model, regionType, regionId |
| **业务分类** | 选择业务分类 | v-model, itemcode, multiple |
| **单位选择** | 选择组织单位 | v-model, multiple, option, finOrgOption |
| **用户选择** | 选择用户信息 | v-model, multiple, option |

#### 2.3 中台组件通用参数

| 参数 | 说明 | 类型 | 默认值 |
|------|------|------|--------|
| v-model | 绑定值 | string / Array | - |
| multiple | 是否多选 | boolean | false |
| disabled | 是否禁用 | boolean | false |
| readonly | 是否只读 | boolean | true |
| vipAddress | 项目组地址 | String | '' |
| ecp | 是否走ECP服务 | boolean | false |
| option | 配置选项 | Object | - |
| filterOption | 过滤条件 | Object | - |

#### 2.4 中台组件事件

```javascript
@input="handleInput"           // 返回所选值
@input:data="handleInputData"  // 返回所选值对应的对象数据
@change="handleChange"         // 值发生变化时触发
@clear="handleClear"           // 清空按钮点击时触发
@blur="handleBlur"             // 失去焦点时触发
@focus="handleFocus"           // 获得焦点时触发
```

#### 2.5 币种选择控件(currency-select)
```bash
npm install jt.tswan.components@XX
```

**主要参数:**
| 参数 | 说明 | 类型 | 默认值 |
|------|------|------|-------|
| value / v-model | 绑定值 | string / Array | - |
| text | 展示文字 | String/Function | - |
| disabled | 是否禁用 | boolean | false |
| readonly | 是否只读 | boolean | true |
| ecp | 是否走ECP服务 | boolean | false |
| vipAddress | 项目组的vipAddress | String | '' |

#### 2.6 枚举选择控件(enum-select)
**主要参数:**
| 参数 | 说明 | 类型 | 默认值 |
|------|------|------|-------|
| value / v-model | 绑定值 | string / Array | - |
| entityTypeId | 枚举类型ID | String | - |
| enumType | 枚举类型ID | String | - |
| type | 枚举系统 | String | 'enum' |
| multiple | 是否支持多选 | boolean | false |
| collapseTags | 多选标签展示行为 | boolean | true |
| placeholder | 占位符 | String | 请选择 |
| defaultId | 默认选中的id | String | '' |
| clearSelected | 是否清空 | boolean | false |
| qzzSelect | 多选时是否需要qzz下拉 | boolean | true |
| vipAddress | 项目组的vipAddress | String | '' |

#### 2.7 管理对象选择控件(gldx-select)

管理对象选择控件用于在表单中选择管理对象，支持单选和多选模式。

**组件引入**：
```javascript
// 在index.yjpl中引入
import GldxSelect from 'jt.tswan.cp.dcc.biz.web/packages/bizcontrol/gldx-select/gldx.yjpl';

// 在组件中注册
components() {
  return {
    'gldx': GldxSelect
  };
}

// 表格编辑器引入（在Model.ts中）
import gldxEdit from 'jt.tswan.cp.dcc.biz.web/packages/bizcontrol/gldx-select/gldx.grid.edit.js';
```

**基本使用**：
```html
<template>
  <div class="entity-select">
    <gldx
        v-model="value"
        :dxlx-id="dxlxId"
        :vip-address="vipAddress"
        :multiple="multiple"
        :is-show-ty-check-box="true">
    </gldx>
  </div>
</template>

<script>
  export default {
    data() {
      return {
        value: '',
        multiple: false,
        dxlxId: '5001',
        vipAddress: '/necp/mapp/metamodel'
      };
    }
  };
</script>
```

**在YJPL模板中使用**：
```javascript
// MetaModel.ts
query: [
  {
    name: 'gldx',
    dataType: 'gldx',
    label: '管理对象',
    value: [],
    dxlxId: '5001',
    multiple: true,
    vipAddress: '/necp/mapp/metamodel'
  }
]
```

**在QZZ表格中使用**：
```javascript
// 表格配置
grid: {
  colModels: [
    {
      name: 'gldx',
      index: 'gldx',
      width: 150,
      dataType: 'gldx',
      editType: gldxEdit,
      dxlxId: '5001',
      ecp: true
    }
  ]
}
```

**主要参数**：
| 参数 | 说明 | 类型 | 默认值 |
|------|------|------|-------|
| v-model | 绑定值 | string / Array | - |
| dxlxId | 管理对象类型ID | String | - |
| multiple | 是否多选 | boolean | false |
| filterOption | 过滤条件配置 | Object | - |
| filterTy | 是否默认勾选显示停用 | boolean

---

## Mock数据规则

### 1. Mock概述

Mock是一种在前后端分离开发中常用的技术，用于模拟后端API接口返回的数据。在YJPL框架中，Mock机制允许前端开发人员在后端API尚未完成或不可用的情况下，继续进行前端开发和测试工作。

#### Mock的作用
- **加速开发流程**：不需要等待后端API完成，前端可以独立开发
- **提高开发效率**：避免因后端服务不稳定导致的开发中断
- **便于测试**：可以模拟各种数据场景，包括边界条件和错误情况
- **降低依赖**：减少对后端服务的依赖，提高开发灵活性

### 2. Mock配置

#### 目录结构
根据YJPL项目结构，Mock相关文件位于项目的`src/mock`目录下：

```
src
 |- mock      mock数据目录
 |     |- index.ts  主要的mock配置文件
```

#### 基本配置方法
在`src/mock/index.ts`文件中配置mock规则，主要分为两类请求的拦截：
- `doGet`：拦截GET请求
- `doPost`：拦截POST请求

基本配置结构如下：

```js
export default {
    doGet: {
        '/api/path': {
            data(param: any) {
                return '模拟的返回数据';
            }
        }
    },
    
    doPost: {
        '/api/path': {
            data(param: any) {
                return '模拟的返回数据';
            }
        }
    }
};
```

### 3. Mock规则详解

#### 3.1 GET请求拦截
```js
doGet: {
    '/model/metaModel': {  // API路径
        data(param: any) { // 接收请求参数
            return '这里是模拟的GET请求返回数据';  // 直接返回业务数据
        }   
    }
}
```

#### 3.2 POST请求拦截
```js
doPost: {
    '/model/metaModel': {  // API路径
        data(param: any) { // 接收请求参数
            return '这里是模拟的POST请求返回数据';  // 直接返回业务数据
        }
    }
}
```

### 4. 高级用法

#### 4.1 动态生成数据
```js
doGet: {
    '/api/users': {
        data(param: any) {
            const users = [];
            for (let i = 0; i < 10; i++) {
                users.push({
                    id: i,
                    name: `用户${i}`,
                    age: 20 + Math.floor(Math.random() * 20)
                });
            }
            return users;  // 直接返回业务数据
        }
    }
}
```

#### 4.2 模拟延迟响应
```js
doGet: {
    '/api/slowData': {
        data(param: any) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve('延迟返回的数据');  // 直接返回业务数据
                }, 1000); // 延迟1秒返回
            });
        }
    }
}
```

#### 4.3 根据参数返回不同数据
```js
doPost: {
    '/api/user/info': {
        data(param: any) {
            if (param.userId === '1') {
                return {  // 直接返回业务数据
                    id: '1',
                    name: '管理员',
                    role: 'admin'
                };
            } else {
                return {  // 直接返回业务数据
                    id: param.userId,
                    name: '普通用户',
                    role: 'user'
                };
            }
        }
    }
}
```

#### 4.4 模拟错误情况
```js
doGet: {
    '/api/errorDemo': {
        data(param: any) {
            throw new Error('服务器内部错误');
        }
    }
}
```

### 5. 最佳实践

#### 5.1 组织Mock数据
对于复杂项目，建议将mock数据按模块或功能分离到不同文件中：

```js
// src/mock/user.ts
export default {
    doGet: {
        '/api/user/list': { /* ... */ }
    },
    doPost: {
        '/api/user/add': { /* ... */ }
    }
};

// src/mock/index.ts
import userMock from './user';
import productMock from './product';

export default {
    doGet: {
        ...userMock.doGet,
        ...productMock.doGet
    },
    doPost: {
        ...userMock.doPost,
        ...productMock.doPost
    }
};
```

#### 5.2 分页数据模拟
```js
doPost: {
    '/api/data/page': {
        data(param: any) {
            const { pageSize = 10, pageNum = 1 } = param;
            const total = 100;
            const list = [];
            
            const startIndex = (pageNum - 1) * pageSize;
            const endIndex = Math.min(startIndex + pageSize, total);
            
            for (let i = startIndex; i < endIndex; i++) {
                list.push({
                    id: i,
                    name: `项目${i}`,
                    description: `这是项目${i}的描述`
                });
            }
            
            return {  // 直接返回业务数据
                list,
                total,
                pageSize,
                pageNum,
                pages: Math.ceil(total / pageSize)
            };
        }
    }
}
```

#### 5.3 文件上传模拟
```js
doPost: {
    '/api/upload': {
        data(param: any) {
            return {  // 直接返回业务数据
                fileId: 'mock_file_' + Date.now(),
                fileName: param.fileName || 'unknown.file',
                fileUrl: 'https://example.com/files/mock_file.jpg'
            };
        }
    }
}
```

#### 5.4 登录认证模拟
```js
doPost: {
    '/api/login': {
        data(param: any) {
            const { username, password } = param;
            
            if (username === 'admin' && password === 'admin123') {
                return {  // 直接返回业务数据
                    token: 'mock_token_' + Date.now(),
                    userInfo: {
                        id: '1',
                        username: 'admin',
                        name: '管理员',
                        roles: ['admin']
                    }
                };
            } else {
                throw new Error('用户名或密码错误');
            }
        }
    }
}
```

### 6. 注意事项

1. **保持数据结构一致**：Mock数据的结构应与实际API返回的数据结构保持一致
2. **及时更新**：当后端API发生变化时，应及时更新对应的Mock数据
3. **避免过度依赖**：Mock数据只是开发阶段的辅助工具，最终产品应该与实际API进行充分测试
4. **注意数据安全**：不要在Mock数据中包含敏感信息或真实的业务数据
5. **性能考虑**：复杂的Mock数据生成逻辑可能会影响开发环境的性能

---

## 性能优化建议

### 1. 大数据列表优化

```typescript
// ✓ 推荐：使用虚拟滚动
grid: {
  virtual: true,
  virtualSize: 20,
  pageSize: 20
}

// ✓ 推荐：使用分页
grid: {
  pageSize: 20,
  showPagination: true
}

// ✗ 避免：一次加载所有数据
dataModel.grid = allData  // 数据过多导致性能问题
```

### 2. 表格列优化

```typescript
// ✓ 推荐：指定列宽
columns: [
  { key: 'id', label: 'ID', width: 80 },
  { key: 'name', label: '名称', width: 150 }
]

// ✓ 推荐：使用格式化
columns: [
  { key: 'amount', label: '金额', formatType: 'money', scale: 2 }
]

// ✗ 避免：过多的自定义渲染
columns: [
  { key: 'status', render: (h, row) => {...} }  // 性能差
]
```

### 3. 事件处理优化

```typescript
// ✓ 推荐：使用事件委托
eventsModel: {
  grid: {
    'row-click': (row) => this.handleRowClick(row)
  }
}

// ✗ 避免：在模板中处理复杂逻辑
@click="complexLogic(item, index, event)"
```

### 4. 监听器优化

```typescript
// ✓ 推荐：深度监听必要字段
watch: {
  'dataModel.query': {
    handler() { /* ... */ },
    deep: true
  }
}

// ✗ 避免：监听整个对象
watch: {
  dataModel: {
    handler() { /* ... */ },
    deep: true
  }
}
```

---

## AI 提示词模板

### 模板 1：生成标准列表查询页面

```
我需要使用 YJPL 框架的 list-template 模板生成一个[页面名称]页面。

需求：
- 页面标题：[标题]
- 查询字段：[字段列表]
- 表格列：[列信息]
- 功能按钮：[按钮列表]
- 是否需要树形导航：[是/否]
- 是否需要多视图：[是/否]

请按照以下结构生成代码：
1. MetaModel.ts - 页面配置
2. DataModel.ts - 数据模型
3. Business.ts - 业务逻辑
4. index.yjpl - 主模板文件

参考规范：
- 查询字段使用标准的 dataType（text, date, combobox 等）
- 表格配置包含列宽、对齐方式、格式化等
- Business 类继承 YJBusiness，实现 getGridData 等方法
- 使用 plugins 进行模板扩展
```

### 模板 2：生成业务单据页面

```
我需要使用 YJPL 框架的 page/ywdj 模板生成一个[单据类型]页面。

需求：
- 单据标题：[标题]
- 表单字段：[字段列表]
- 子表配置：[子表信息]
- 是否需要审批流程：[是/否]
- 是否需要附件管理：[是/否]
- 侧边栏内容：[侧边栏配置]

请生成：
1. pageModel.ts - 页面配置
2. dataModel.ts - 数据模型
3. index.yjpl - 主模板文件
4. 必要的子组件

参考规范：
- 表单字段使用标准的 dataType
- 子表支持多个表格（数组形式）
- 使用 anchor 配置锚点导航
- 使用 plugins 自定义各个区域
```

### 模板 3：扩展现有模板

```
我需要扩展 YJPL 的 list-template 模板，实现以下功能：

需求：
- 移除/替换的区域：[选择器]
- 新增的功能：[功能描述]
- 自定义组件：[组件列表]

请使用 plugins 标签进行以下操作：
1. type="remove" - 移除不需要的区域
2. type="replace" - 替换现有区域
3. type="append" - 追加新内容

参考实现：
- 自定义工具栏 - 使用 replace 替换 .query-toolbar
- 自定义侧边栏 - 使用 replace 替换 .bill-aside
- 自定义查询面板 - 使用 replace 替换 .query-search-panel
```

### 模板 4：实现特定功能

```
我需要在 YJPL 页面中实现[功能名称]。

需求：
- 功能描述：[详细描述]
- 触发方式：[如何触发]
- 数据流：[数据如何流动]
- 交互方式：[用户交互方式]

请提供：
1. 所需的数据模型修改
2. 所需的方法实现
3. 所需的事件处理
4. 所需的模板修改

参考规范：
- 使用 eventsModel 处理事件
- 使用 stateModel 管理状态
- 使用 dataModel 存储数据
- 使用 metaModel 配置 UI
```

### 模板 5：集成中台组件

```
我需要在 YJPL 页面中集成[中台组件名称]。

需求：
- 组件功能：[功能描述]
- 集成位置：[在页面的哪个位置]
- 参数配置：[需要的参数]
- 事件处理：[需要处理的事件]

请提供：
1. 组件引入方式
2. 组件配置参数
3. 事件处理代码
4. 完整的集成示例

参考规范：
- 遵循中台组件的参数规范
- 正确处理组件的输入输出
- 与现有页面逻辑的集成
```

### 模板 6：配置Mock数据

```
我需要为[API路径]配置Mock数据。

需求：
- API路径：[路径]
- 请求方式：[GET/POST]
- 请求参数：[参数列表]
- 返回数据结构：[数据结构]
- 特殊场景：[需要模拟的特殊情况]

请提供：
1. Mock配置代码
2. 数据生成逻辑
3. 错误处理
4. 测试用例

参考规范：
- 直接返回业务数据
- 支持参数动态生成
- 支持延迟响应
- 支持错误模拟
```

---

## 最佳实践总结

### ✓ 推荐做法

1. **分离关注点**
   - MetaModel：页面配置（静态）
   - DataModel：业务数据（动态）
   - StateModel：组件状态（控制）
   - Business：业务逻辑（处理）

2. **使用模板扩展**
   - 优先使用 plugins 进行扩展
   - 避免完全重写模板
   - 保持代码的可维护性

3. **规范命名**
   - 文件名使用 PascalCase（MetaModel.ts）
   - 变量名使用 camelCase（dataModel）
   - CSS 类名使用 kebab-case（.query-toolbar）

4. **事件处理**
   - 使用 eventsModel 统一管理事件
   - 在 methods 中实现事件处理器
   - 避免在模板中处理复杂逻辑

5. **性能优化**
   - 使用分页处理大数据
   - 避免深度监听整个对象
   - 使用虚拟滚动处理长列表

### ✗ 避免做法

1. **混合数据和配置**
   ```typescript
   // ✗ 不推荐
   data: {
    title: '用户列表',
    users: [],
    query: {}
   }
   
   // ✓ 推荐
   metaModel: { title: '用户列表' }
   dataModel: { users: [], query: {} }
   ```

2. **直接修改模板**
   ```xml
   <!-- ✗ 不推荐：直接修改模板文件 -->
   
   <!-- ✓ 推荐：使用 plugins 扩展 -->
   <plugins type="replace" target=".query-toolbar">
     <!-- 自定义内容 -->
   </plugins>
   ```

3. **过度自定义**
   ```typescript
   // ✗ 不推荐：完全自定义，失去模板优势
   export default class CustomPage extends Vue {
     // 从零开始实现所有功能
   }
   
   // ✓ 推荐：继承模板，按需扩展
   export default class CustomPage extends ListTemplate {
     // 只实现差异部分
   }
   ```

4. **忽视性能**
   ```typescript
   // ✗ 不推荐：一次加载所有数据
   this.dataModel.grid = allData;
   
   // ✓ 推荐：使用分页
   grid: { pageSize: 20, showPagination: true }
   ```

---

## 快速参考

### 常用字段类型

| 类型 | 说明 | 示例 |
|------|------|------|
| `text` | 文本输入 | `{ dataType: 'text' }` |
| `number` | 数字输入 | `{ dataType: 'number' }` |
| `date` | 日期选择 | `{ dataType: 'date' }` |
| `datetime` | 日期时间 | `{ dataType: 'datetime' }` |
| `combobox` | 下拉选择 | `{ dataType: 'combobox', options: [...] }` |
| `entity-select` | 实体选择 | `{ dataType: 'entity-select' }` |
| `textarea` | 多行文本 | `{ dataType: 'textarea' }` |
| `switch` | 开关 | `{ dataType: 'switch' }` |

### 常用图标

| 图标 | 说明 |
|------|------|
| `yj-p-add` | 新增 |
| `yj-p-edit` | 编辑 |
| `yj-p-delete` | 删除 |
| `yj-p-save` | 保存 |
| `yj-p-print` | 打印 |
| `yj-p-export` | 导出 |
| `yj-p-import` | 导入 |
| `yj-p-search` | 搜索 |
| `yj-p-refresh` | 刷新 |
| `yj-p-ai` | AI |

### 常用状态值

| 状态 | 说明 |
|------|------|
| `DEFAULT` | 默认状态（可用） |
| `DISABLED` | 禁用状态 |
| `LOADING` | 加载状态 |
| `HIDDEN` | 隐藏状态 |

---

## 总结

通过遵循本指南，你可以：

1. **快速选择合适的模板** - 根据页面特征选择 list-template 或 ywdj 模板
2. **规范代码结构** - 使用三层数据模型分离关注点
3. **高效扩展模板** - 使用 plugins 进行灵活的模板扩展
4. **实现常见功能** - 参考样例代码快速实现各种功能
5. **优化性能** - 遵循最佳实践避免常见性能问题
6. **与 AI 协作** - 使用提示词模板与 AI 高效沟通
7. **集成中台组件** - 充分利用企业级中台组件库
8. **配置Mock数据** - 快速进行前端开发和测试

**记住：** 模板的目的是提高开发效率，而不是限制灵活性。在遵循规范的前提下，充分利用 plugins 进行扩展，可以实现既规范又灵活的前端界面。

---

**最后更新**: 2025-12-04  
**版本**: 8.5.0  
**维护者**: UEC

---
