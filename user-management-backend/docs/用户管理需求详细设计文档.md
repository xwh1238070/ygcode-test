# 用户管理需求详细设计文档

## 1. 需求概述

### 1.1 项目背景
为用户管理前端页面提供完整的后端服务支持，实现用户的全生命周期管理，包括用户信息的增删改查、状态管理、密码管理以及数据导入导出功能。

### 1.2 业务场景
- 系统管理员进行用户管理
- 支持多条件查询和分页
- 支持批量操作（删除、启用、禁用、重置密码）
- 支持数据导入导出

### 1.3 技术栈
- **框架**: Spring Boot 2.x
- **JDK**: 1.8
- **数据库**: MySQL 5.7+
- **数据访问**: JPA + ORMap 框架
- **API 文档**: Swagger

## 2. 功能点分析

### 2.1 核心功能

#### 2.1.1 查询功能
- **用户列表查询**: 支持分页、多条件组合查询
  - 用户名模糊查询
  - 姓名模糊查询
  - 部门筛选
  - 角色筛选
  - 状态筛选（启用/禁用）
  - 创建日期范围查询
- **用户总数查询**: 获取符合条件的用户总数
- **用户详情查询**: 根据用户ID查询详细信息

#### 2.1.2 数据管理功能
- **新增用户**: 创建新用户，自动生成用户ID，设置默认密码
- **编辑用户**: 更新用户基本信息（不包括密码）
- **删除用户**: 物理删除用户，支持批量删除

#### 2.1.3 用户操作功能
- **重置密码**: 将用户密码重置为默认密码，支持批量操作
- **启用用户**: 将用户状态设置为启用，支持批量操作
- **禁用用户**: 将用户状态设置为禁用，支持批量操作

#### 2.1.4 数据交换功能
- **导出数据**: 将用户数据导出为 Excel 文件
- **导入数据**: 从 Excel 文件批量导入用户数据

### 2.2 功能优先级
1. **P0（高优先级）**: 查询、新增、编辑、删除
2. **P1（中优先级）**: 启用、禁用、重置密码
3. **P2（低优先级）**: 导入、导出

## 3. 数据库设计

### 3.1 用户表（TBL_USER）

#### 3.1.1 表结构

| 字段名 | 数据类型 | 长度 | 精度 | 是否主键 | 是否为空 | 默认值 | 说明 |
|--------|---------|------|------|---------|---------|--------|------|
| C_USER_ID | VARCHAR | 20 | - | 是 | 否 | - | 用户ID，主键 |
| C_USERNAME | VARCHAR | 50 | - | 否 | 否 | - | 用户名，唯一 |
| C_PASSWORD | VARCHAR | 200 | - | 否 | 否 | - | 密码（加密） |
| C_REAL_NAME | VARCHAR | 50 | - | 否 | 否 | - | 真实姓名 |
| C_DEPARTMENT_ID | VARCHAR | 20 | - | 否 | 是 | - | 部门ID |
| C_DEPARTMENT | VARCHAR | 100 | - | 否 | 是 | - | 部门名称 |
| C_ROLE_ID | VARCHAR | 20 | - | 否 | 是 | - | 角色ID |
| C_ROLE | VARCHAR | 50 | - | 否 | 是 | - | 角色名称 |
| C_PHONE | VARCHAR | 20 | - | 否 | 是 | - | 手机号 |
| C_EMAIL | VARCHAR | 100 | - | 否 | 是 | - | 邮箱 |
| C_STATUS | VARCHAR | 1 | - | 否 | 否 | '1' | 状态：1-启用，0-禁用 |
| C_CREATE_TIME | DATETIME | - | - | 否 | 否 | CURRENT_TIMESTAMP | 创建时间 |
| C_UPDATE_TIME | DATETIME | - | - | 否 | 是 | - | 更新时间 |
| C_LAST_LOGIN_TIME | DATETIME | - | - | 否 | 是 | - | 最后登录时间 |
| C_CREATOR | VARCHAR | 50 | - | 否 | 是 | - | 创建人 |
| C_UPDATER | VARCHAR | 50 | - | 否 | 是 | - | 更新人 |

#### 3.1.2 索引设计

| 索引名 | 索引类型 | 字段 | 说明 |
|--------|---------|------|------|
| PK_USER | PRIMARY KEY | C_USER_ID | 主键索引 |
| UK_USERNAME | UNIQUE | C_USERNAME | 用户名唯一索引 |
| IDX_DEPARTMENT | INDEX | C_DEPARTMENT_ID | 部门索引 |
| IDX_ROLE | INDEX | C_ROLE_ID | 角色索引 |
| IDX_STATUS | INDEX | C_STATUS | 状态索引 |
| IDX_CREATE_TIME | INDEX | C_CREATE_TIME | 创建时间索引 |

#### 3.1.3 建表 SQL

```sql
CREATE TABLE TBL_USER (
    C_USER_ID VARCHAR(20) NOT NULL COMMENT '用户ID',
    C_USERNAME VARCHAR(50) NOT NULL COMMENT '用户名',
    C_PASSWORD VARCHAR(200) NOT NULL COMMENT '密码',
    C_REAL_NAME VARCHAR(50) NOT NULL COMMENT '真实姓名',
    C_DEPARTMENT_ID VARCHAR(20) COMMENT '部门ID',
    C_DEPARTMENT VARCHAR(100) COMMENT '部门名称',
    C_ROLE_ID VARCHAR(20) COMMENT '角色ID',
    C_ROLE VARCHAR(50) COMMENT '角色名称',
    C_PHONE VARCHAR(20) COMMENT '手机号',
    C_EMAIL VARCHAR(100) COMMENT '邮箱',
    C_STATUS VARCHAR(1) NOT NULL DEFAULT '1' COMMENT '状态：1-启用，0-禁用',
    C_CREATE_TIME DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    C_UPDATE_TIME DATETIME COMMENT '更新时间',
    C_LAST_LOGIN_TIME DATETIME COMMENT '最后登录时间',
    C_CREATOR VARCHAR(50) COMMENT '创建人',
    C_UPDATER VARCHAR(50) COMMENT '更新人',
    PRIMARY KEY (C_USER_ID),
    UNIQUE KEY UK_USERNAME (C_USERNAME),
    KEY IDX_DEPARTMENT (C_DEPARTMENT_ID),
    KEY IDX_ROLE (C_ROLE_ID),
    KEY IDX_STATUS (C_STATUS),
    KEY IDX_CREATE_TIME (C_CREATE_TIME)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

### 3.2 数据模型设计

#### 3.2.1 UserPO（持久化对象）

```java
@Entity
@Table(name = "TBL_USER")
public class UserPO {
    @Id
    @Column(name = "C_USER_ID", length = 20)
    private String userId;
    
    @Column(name = "C_USERNAME", length = 50, nullable = false, unique = true)
    private String username;
    
    @Column(name = "C_PASSWORD", length = 200, nullable = false)
    private String password;
    
    @Column(name = "C_REAL_NAME", length = 50, nullable = false)
    private String realName;
    
    @Column(name = "C_DEPARTMENT_ID", length = 20)
    private String departmentId;
    
    @Column(name = "C_DEPARTMENT", length = 100)
    private String department;
    
    @Column(name = "C_ROLE_ID", length = 20)
    private String roleId;
    
    @Column(name = "C_ROLE", length = 50)
    private String role;
    
    @Column(name = "C_PHONE", length = 20)
    private String phone;
    
    @Column(name = "C_EMAIL", length = 100)
    private String email;
    
    @Column(name = "C_STATUS", length = 1, nullable = false)
    private String status;
    
    @Column(name = "C_CREATE_TIME", nullable = false)
    private Date createTime;
    
    @Column(name = "C_UPDATE_TIME")
    private Date updateTime;
    
    @Column(name = "C_LAST_LOGIN_TIME")
    private Date lastLoginTime;
    
    @Column(name = "C_CREATOR", length = 50)
    private String creator;
    
    @Column(name = "C_UPDATER", length = 50)
    private String updater;
    
    // getter/setter 省略
}
```

#### 3.2.2 UserBO（业务对象）

```java
public class UserBO {
    private String userId;
    private String username;
    private String password;
    private String realName;
    private String departmentId;
    private String department;
    private String roleId;
    private String role;
    private String phone;
    private String email;
    private String status;
    private Date createTime;
    private Date updateTime;
    private Date lastLoginTime;
    private String creator;
    private String updater;
    
    // getter/setter 省略
}
```

#### 3.2.3 UserVO（视图对象）

```java
public class UserVO {
    private String userId;
    private String username;
    private String realName;
    private String department;
    private String role;
    private String phone;
    private String email;
    private String status;
    private String createTime;  // 格式化后的字符串
    private String lastLoginTime;  // 格式化后的字符串
    
    // getter/setter 省略
}
```

#### 3.2.4 UserQueryVO（查询条件对象）

```java
public class UserQueryVO {
    private String username;      // 用户名（模糊查询）
    private String realName;      // 姓名（模糊查询）
    private String department;    // 部门
    private String role;          // 角色
    private String status;        // 状态
    private String[] createTime;  // 创建日期范围 [开始日期, 结束日期]
    private Integer pageSize;     // 每页大小
    private Integer pageIndex;    // 页码
    
    // getter/setter 省略
}
```

#### 3.2.5 UserBatchVO（批量操作对象）

```java
public class UserBatchVO {
    private List<String> userIds;  // 用户ID列表
    
    // getter/setter 省略
}
```

## 4. 接口设计

### 4.1 接口基础信息

- **基础路径**: `{securitydomain}/{vipaddress}/{读写分离标识}/model/user/`
- **安全域**: `member`（前端应用调用）
- **返回格式**: `CommonResult<T>`

### 4.2 接口列表

#### 4.2.1 查询用户列表

**接口地址**: `/list`  
**请求方式**: POST  
**接口说明**: 分页查询用户列表，支持多条件组合查询

**请求参数**:
```json
{
  "username": "admin",
  "realName": "张三",
  "department": "技术部",
  "role": "系统管理员",
  "status": "1",
  "createTime": ["2024-01-01", "2024-12-31"],
  "pageSize": 20,
  "pageIndex": 1
}
```

**响应参数**:
```json
{
  "code": 0,
  "message": "success",
  "data": [
    {
      "userId": "U001",
      "username": "admin",
      "realName": "张三",
      "department": "技术部",
      "role": "系统管理员",
      "phone": "13800138001",
      "email": "zhangsan@example.com",
      "status": "启用",
      "createTime": "2024-01-15 10:30:00",
      "lastLoginTime": "2024-12-15 09:15:00"
    }
  ]
}
```

#### 4.2.2 获取用户总数

**接口地址**: `/count`  
**请求方式**: POST  
**接口说明**: 获取符合查询条件的用户总数

**请求参数**: 同查询条件

**响应参数**:
```json
{
  "code": 0,
  "message": "success",
  "data": 100
}
```

#### 4.2.3 获取用户详情

**接口地址**: `/detail`  
**请求方式**: POST  
**接口说明**: 根据用户ID查询用户详细信息

**请求参数**:
```json
{
  "userId": "U001"
}
```

**响应参数**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "userId": "U001",
    "username": "admin",
    "realName": "张三",
    "department": "技术部",
    "role": "系统管理员",
    "phone": "13800138001",
    "email": "zhangsan@example.com",
    "status": "启用",
    "createTime": "2024-01-15 10:30:00",
    "lastLoginTime": "2024-12-15 09:15:00"
  }
}
```

#### 4.2.4 新增用户

**接口地址**: `/add`  
**请求方式**: POST  
**接口说明**: 创建新用户

**请求参数**:
```json
{
  "username": "newuser",
  "realName": "新用户",
  "department": "技术部",
  "role": "普通用户",
  "phone": "13800138888",
  "email": "newuser@example.com"
}
```

**响应参数**:
```json
{
  "code": 0,
  "message": "success",
  "data": "U002"
}
```

#### 4.2.5 编辑用户

**接口地址**: `/edit`  
**请求方式**: POST  
**接口说明**: 更新用户信息

**请求参数**:
```json
{
  "userId": "U001",
  "realName": "张三",
  "department": "技术部",
  "role": "系统管理员",
  "phone": "13800138001",
  "email": "zhangsan@example.com"
}
```

**响应参数**:
```json
{
  "code": 0,
  "message": "success",
  "data": true
}
```

#### 4.2.6 删除用户

**接口地址**: `/delete`  
**请求方式**: POST  
**接口说明**: 删除用户，支持批量删除

**请求参数**:
```json
{
  "userIds": ["U001", "U002"]
}
```

**响应参数**:
```json
{
  "code": 0,
  "message": "success",
  "data": 2
}
```

#### 4.2.7 重置密码

**接口地址**: `/resetPassword`  
**请求方式**: POST  
**接口说明**: 重置用户密码为默认密码，支持批量操作

**请求参数**:
```json
{
  "userIds": ["U001", "U002"]
}
```

**响应参数**:
```json
{
  "code": 0,
  "message": "success",
  "data": 2
}
```

#### 4.2.8 启用用户

**接口地址**: `/enable`  
**请求方式**: POST  
**接口说明**: 启用用户，支持批量操作

**请求参数**:
```json
{
  "userIds": ["U001", "U002"]
}
```

**响应参数**:
```json
{
  "code": 0,
  "message": "success",
  "data": 2
}
```

#### 4.2.9 禁用用户

**接口地址**: `/disable`  
**请求方式**: POST  
**接口说明**: 禁用用户，支持批量操作

**请求参数**:
```json
{
  "userIds": ["U001", "U002"]
}
```

**响应参数**:
```json
{
  "code": 0,
  "message": "success",
  "data": 2
}
```

#### 4.2.10 导出数据

**接口地址**: `/export`  
**请求方式**: POST  
**接口说明**: 导出用户数据为 Excel 文件

**请求参数**: 同查询条件

**响应参数**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "fileUrl": "/download/users_export_20241215.xlsx",
    "fileName": "用户数据_20241215.xlsx"
  }
}
```

#### 4.2.11 导入数据

**接口地址**: `/import`  
**请求方式**: POST  
**接口说明**: 从 Excel 文件导入用户数据

**请求参数**: FormData（包含文件）

**响应参数**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "successCount": 10,
    "failCount": 0,
    "errorMessages": []
  }
}
```

## 5. 业务规则

### 5.1 用户名规则
- 长度：3-50 个字符
- 格式：字母、数字、下划线
- 唯一性：系统内唯一

### 5.2 密码规则
- 默认密码：`123456`
- 加密方式：BCrypt
- 重置密码：重置为默认密码

### 5.3 状态规则
- `1`：启用
- `0`：禁用
- 新增用户默认启用

### 5.4 用户ID生成规则
- 格式：`U` + 时间戳（13位） + 随机数（3位）
- 示例：`U1702627200001123`

### 5.5 批量操作规则
- 最大批量数：100
- 失败策略：部分失败继续执行，返回成功和失败数量

## 6. 异常处理

### 6.1 错误码定义

| 错误码 | 说明 |
|--------|------|
| 0 | 成功 |
| 1001 | 用户名已存在 |
| 1002 | 用户不存在 |
| 1003 | 用户名格式不正确 |
| 1004 | 必填字段为空 |
| 1005 | 批量操作数量超限 |
| 1006 | 导入文件格式错误 |
| 9999 | 系统异常 |

### 6.2 异常处理策略
- 参数验证异常：返回错误码和提示信息
- 业务异常：返回错误码和提示信息
- 系统异常：记录日志，返回通用错误信息

## 7. 性能要求

### 7.1 响应时间
- 查询接口：< 500ms
- 新增/编辑：< 300ms
- 批量操作：< 2s
- 导出：< 5s

### 7.2 并发要求
- 支持 100 并发用户
- 查询 QPS：500+

### 7.3 数据量
- 预计用户数：10000+
- 单次查询最大返回：1000 条

## 8. 安全要求

### 8.1 密码安全
- 密码加密存储
- 日志中不输出密码
- 接口返回不包含密码

### 8.2 SQL 注入防护
- 使用绑定变量
- 参数验证

### 8.3 权限控制
- 接口需要登录认证
- 操作需要权限验证

## 9. 测试要点

### 9.1 功能测试
- 所有接口的正常流程
- 边界值测试
- 异常流程测试

### 9.2 性能测试
- 并发测试
- 压力测试
- 大数据量测试

### 9.3 安全测试
- SQL 注入测试
- 参数验证测试
- 权限测试

## 10. 部署说明

### 10.1 环境要求
- JDK 1.8+
- MySQL 5.7+
- Maven 3.6+

### 10.2 配置项
- 数据库连接
- 默认密码
- 文件上传路径
- 日志级别

### 10.3 初始化
- 执行建表 SQL
- 创建初始管理员账号

---

**文档版本**: v1.0  
**编写日期**: 2024-12-15  
**编写人**: 系统架构师
