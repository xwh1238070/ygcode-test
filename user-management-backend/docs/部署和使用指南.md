# ç”¨æˆ·ç®¡ç†åç«¯é¡¹ç›® - éƒ¨ç½²å’Œä½¿ç”¨æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
2. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
3. [é¡¹ç›®é…ç½®](#é¡¹ç›®é…ç½®)
4. [æ•°æ®åº“åˆå§‹åŒ–](#æ•°æ®åº“åˆå§‹åŒ–)
5. [é¡¹ç›®å¯åŠ¨](#é¡¹ç›®å¯åŠ¨)
6. [API æµ‹è¯•](#api-æµ‹è¯•)
7. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
8. [ç”Ÿäº§éƒ¨ç½²](#ç”Ÿäº§éƒ¨ç½²)

---

## ç¯å¢ƒè¦æ±‚

### å¿…éœ€è½¯ä»¶

| è½¯ä»¶ | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜ |
|------|---------|------|
| JDK | 1.8+ | Java å¼€å‘ç¯å¢ƒ |
| Maven | 3.6+ | é¡¹ç›®æ„å»ºå·¥å…· |
| MySQL | 5.7+ | æ•°æ®åº“ |
| IDE | ä»»æ„ | æ¨è IntelliJ IDEA æˆ– Eclipse |

### å¯é€‰è½¯ä»¶

- Gitï¼ˆç‰ˆæœ¬æ§åˆ¶ï¼‰
- Postmanï¼ˆAPI æµ‹è¯•ï¼‰
- Redisï¼ˆç¼“å­˜ï¼Œå¯é€‰ï¼‰

---

## å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
# å¦‚æœé¡¹ç›®åœ¨ Git ä»“åº“ä¸­
git clone <repository-url>
cd user-management-backend

# æˆ–ç›´æ¥ä½¿ç”¨å·²æœ‰çš„é¡¹ç›®ç›®å½•
cd user-management-backend
```

### 2. é…ç½® IDE

#### IntelliJ IDEA

1. æ‰“å¼€ IDEAï¼Œé€‰æ‹© `File` -> `Open`
2. é€‰æ‹©é¡¹ç›®æ ¹ç›®å½•ï¼ˆåŒ…å« pom.xml çš„ç›®å½•ï¼‰
3. ç­‰å¾… Maven ä¾èµ–ä¸‹è½½å®Œæˆ
4. å³é”®ç‚¹å‡» `src/main/java` ç›®å½•ï¼Œé€‰æ‹© `Mark Directory as` -> `Sources Root`
5. å³é”®ç‚¹å‡» `src/main/resources` ç›®å½•ï¼Œé€‰æ‹© `Mark Directory as` -> `Resources Root`

#### Eclipse

1. æ‰“å¼€ Eclipseï¼Œé€‰æ‹© `File` -> `Import`
2. é€‰æ‹© `Maven` -> `Existing Maven Projects`
3. é€‰æ‹©é¡¹ç›®æ ¹ç›®å½•
4. ç­‰å¾… Maven ä¾èµ–ä¸‹è½½å®Œæˆ

### 3. å®‰è£…ä¾èµ–

```bash
mvn clean install
```

---

## é¡¹ç›®é…ç½®

### 1. æ•°æ®åº“é…ç½®

ç¼–è¾‘ `src/main/resources/application.yml`ï¼š

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/user_management?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: root        # ä¿®æ”¹ä¸ºä½ çš„æ•°æ®åº“ç”¨æˆ·å
    password: root        # ä¿®æ”¹ä¸ºä½ çš„æ•°æ®åº“å¯†ç 
```

### 2. æœåŠ¡å™¨é…ç½®

```yaml
server:
  port: 8080              # ä¿®æ”¹æœåŠ¡ç«¯å£ï¼ˆå¯é€‰ï¼‰
  servlet:
    context-path: /user-management  # ä¿®æ”¹ä¸Šä¸‹æ–‡è·¯å¾„ï¼ˆå¯é€‰ï¼‰
```

### 3. æ—¥å¿—é…ç½®

```yaml
logging:
  level:
    com.ygsoft.user.management: DEBUG  # å¼€å‘ç¯å¢ƒä½¿ç”¨ DEBUG
  file:
    name: logs/user-management.log     # æ—¥å¿—æ–‡ä»¶è·¯å¾„
```

---

## æ•°æ®åº“åˆå§‹åŒ–

### 1. åˆ›å»ºæ•°æ®åº“

```sql
CREATE DATABASE IF NOT EXISTS user_management 
DEFAULT CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;
```

### 2. æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬

```bash
# æ–¹å¼1ï¼šä½¿ç”¨ MySQL å‘½ä»¤è¡Œ
mysql -u root -p user_management < docs/database/init.sql

# æ–¹å¼2ï¼šä½¿ç”¨ MySQL Workbench æˆ–å…¶ä»–å·¥å…·
# æ‰“å¼€ docs/database/init.sql æ–‡ä»¶å¹¶æ‰§è¡Œ
```

### 3. éªŒè¯æ•°æ®

```sql
USE user_management;

-- æŸ¥çœ‹è¡¨ç»“æ„
SHOW TABLES;

-- æŸ¥çœ‹ç”¨æˆ·æ•°æ®
SELECT * FROM TBL_USER;
```

åº”è¯¥çœ‹åˆ° 5 ä¸ªæµ‹è¯•ç”¨æˆ·ï¼ˆ1ä¸ªç®¡ç†å‘˜ + 4ä¸ªæ™®é€šç”¨æˆ·ï¼‰ã€‚

---

## é¡¹ç›®å¯åŠ¨

### æ–¹å¼1ï¼šä½¿ç”¨ IDE å¯åŠ¨

1. æ‰¾åˆ° `UserManagementApplication.java` æ–‡ä»¶
2. å³é”®ç‚¹å‡»ï¼Œé€‰æ‹© `Run 'UserManagementApplication'`
3. ç­‰å¾…å¯åŠ¨å®Œæˆï¼Œçœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š

```
========================================
ç”¨æˆ·ç®¡ç†ç³»ç»Ÿå¯åŠ¨æˆåŠŸï¼
è®¿é—®åœ°å€: http://localhost:8080/user-management
Swaggeræ–‡æ¡£: http://localhost:8080/user-management/swagger-ui.html
========================================
```

### æ–¹å¼2ï¼šä½¿ç”¨ Maven å¯åŠ¨

```bash
mvn spring-boot:run
```

### æ–¹å¼3ï¼šæ‰“åŒ…åå¯åŠ¨

```bash
# æ‰“åŒ…
mvn clean package

# å¯åŠ¨
java -jar target/user-management.jar
```

---

## API æµ‹è¯•

### 1. è®¿é—® Swagger æ–‡æ¡£

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š
```
http://localhost:8080/user-management/swagger-ui.html
```

### 2. ä½¿ç”¨ Postman æµ‹è¯•

#### æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨

```http
POST http://localhost:8080/user-management/member/vip/rw/model/user/list
Content-Type: application/json

{
  "username": "",
  "realName": "",
  "department": "",
  "role": "",
  "status": "",
  "pageSize": 20,
  "pageIndex": 1
}
```

#### æ–°å¢ç”¨æˆ·

```http
POST http://localhost:8080/user-management/member/vip/rw/model/user/add
Content-Type: application/json

{
  "username": "testuser",
  "realName": "æµ‹è¯•ç”¨æˆ·",
  "department": "æŠ€æœ¯éƒ¨",
  "role": "æ™®é€šç”¨æˆ·",
  "phone": "13800138888",
  "email": "test@example.com"
}
```

#### æŸ¥è¯¢ç”¨æˆ·è¯¦æƒ…

```http
POST http://localhost:8080/user-management/member/vip/rw/model/user/detail
Content-Type: application/json

{
  "userId": "U1702627200001"
}
```

### 3. æµ‹è¯•è´¦å·

| ç”¨æˆ·å | å¯†ç  | è§’è‰² | çŠ¶æ€ |
|--------|------|------|------|
| admin | 123456 | ç³»ç»Ÿç®¡ç†å‘˜ | å¯ç”¨ |
| zhangsan | 123456 | éƒ¨é—¨ç»ç† | å¯ç”¨ |
| lisi | 123456 | æ™®é€šç”¨æˆ· | å¯ç”¨ |
| wangwu | 123456 | æ™®é€šç”¨æˆ· | å¯ç”¨ |
| zhaoliu | 123456 | æ™®é€šç”¨æˆ· | ç¦ç”¨ |

---

## å¸¸è§é—®é¢˜

### 1. ç¼–è¯‘é”™è¯¯ï¼šæ‰¾ä¸åˆ°ç±»

**é—®é¢˜**ï¼šJava æ–‡ä»¶æŠ¥é”™ï¼Œæç¤ºæ‰¾ä¸åˆ°ç±»æˆ–åŒ…

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…ç†å¹¶é‡æ–°æ„å»º
mvn clean install

# åœ¨ IDE ä¸­åˆ·æ–° Maven é¡¹ç›®
# IDEA: å³é”®é¡¹ç›® -> Maven -> Reload Project
# Eclipse: å³é”®é¡¹ç›® -> Maven -> Update Project
```

### 2. æ•°æ®åº“è¿æ¥å¤±è´¥

**é—®é¢˜**ï¼šå¯åŠ¨æ—¶æŠ¥é”™ `Communications link failure`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ MySQL æ˜¯å¦å¯åŠ¨
2. æ£€æŸ¥æ•°æ®åº“è¿æ¥é…ç½®ï¼ˆç”¨æˆ·åã€å¯†ç ã€ç«¯å£ï¼‰
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
4. ç¡®è®¤æ•°æ®åº“å·²åˆ›å»º

### 3. ç«¯å£è¢«å ç”¨

**é—®é¢˜**ï¼šå¯åŠ¨æ—¶æŠ¥é”™ `Port 8080 was already in use`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ–¹å¼1ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£
# application.yml -> server.port: 8081

# æ–¹å¼2ï¼šå…³é—­å ç”¨ç«¯å£çš„è¿›ç¨‹
# Windows
netstat -ano | findstr :8080
taskkill /PID <è¿›ç¨‹ID> /F

# Linux/Mac
lsof -i :8080
kill -9 <è¿›ç¨‹ID>
```

### 4. Swagger é¡µé¢æ— æ³•è®¿é—®

**é—®é¢˜**ï¼šè®¿é—® Swagger é¡µé¢æ˜¾ç¤º 404

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ URL æ˜¯å¦æ­£ç¡®ï¼ˆåŒ…å« context-pathï¼‰
2. æ£€æŸ¥ SwaggerConfig é…ç½®æ˜¯å¦æ­£ç¡®
3. æ¸…ç†æµè§ˆå™¨ç¼“å­˜åé‡è¯•

### 5. æ—¥å¿—æ–‡ä»¶æƒé™é—®é¢˜

**é—®é¢˜**ï¼šå¯åŠ¨æ—¶æŠ¥é”™æ— æ³•åˆ›å»ºæ—¥å¿—æ–‡ä»¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# åˆ›å»ºæ—¥å¿—ç›®å½•å¹¶è®¾ç½®æƒé™
mkdir -p logs
chmod 755 logs
```

---

## ç”Ÿäº§éƒ¨ç½²

### 1. ä¿®æ”¹é…ç½®

ç¼–è¾‘ `application.yml`ï¼Œæ¿€æ´»ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼š

```yaml
spring:
  profiles:
    active: prod
```

### 2. æ‰“åŒ…åº”ç”¨

```bash
# è·³è¿‡æµ‹è¯•æ‰“åŒ…ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
mvn clean package -DskipTests

# æ‰“åŒ…æ–‡ä»¶ä½ç½®
# target/user-management.jar
```

### 3. éƒ¨ç½²åˆ°æœåŠ¡å™¨

```bash
# ä¸Šä¼  jar åŒ…åˆ°æœåŠ¡å™¨
scp target/user-management.jar user@server:/opt/apps/

# SSH ç™»å½•æœåŠ¡å™¨
ssh user@server

# å¯åŠ¨åº”ç”¨
cd /opt/apps
nohup java -jar user-management.jar --spring.profiles.active=prod > app.log 2>&1 &
```

### 4. ä½¿ç”¨ Systemd ç®¡ç†ï¼ˆæ¨èï¼‰

åˆ›å»ºæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/user-management.service`ï¼š

```ini
[Unit]
Description=User Management Backend Service
After=network.target

[Service]
Type=simple
User=appuser
WorkingDirectory=/opt/apps
ExecStart=/usr/bin/java -jar /opt/apps/user-management.jar --spring.profiles.active=prod
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
# é‡æ–°åŠ è½½é…ç½®
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start user-management

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable user-management

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status user-management

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u user-management -f
```

### 5. é…ç½® Nginx åå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location /user-management/ {
        proxy_pass http://localhost:8080/user-management/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 6. ç›‘æ§å’Œæ—¥å¿—

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /var/log/user-management/application.log

# æŸ¥çœ‹ JVM çŠ¶æ€
jps -l
jstat -gc <pid>

# æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€
jstack <pid>
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. JVM å‚æ•°ä¼˜åŒ–

```bash
java -Xms512m -Xmx2g \
     -XX:+UseG1GC \
     -XX:MaxGCPauseMillis=200 \
     -XX:+HeapDumpOnOutOfMemoryError \
     -XX:HeapDumpPath=/var/log/heapdump.hprof \
     -jar user-management.jar
```

### 2. æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–

```yaml
spring:
  datasource:
    hikari:
      minimum-idle: 10
      maximum-pool-size: 50
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
```

### 3. å¯ç”¨ç¼“å­˜ï¼ˆå¯é€‰ï¼‰

```yaml
spring:
  cache:
    type: redis
  redis:
    host: localhost
    port: 6379
```

---

## å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†ç **ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹é»˜è®¤å¯†ç 
2. **ä½¿ç”¨ HTTPS**ï¼šé…ç½® SSL è¯ä¹¦
3. **é™åˆ¶è®¿é—®**ï¼šé…ç½®é˜²ç«å¢™è§„åˆ™
4. **å®šæœŸå¤‡ä»½**ï¼šå®šæœŸå¤‡ä»½æ•°æ®åº“
5. **æ—¥å¿—å®¡è®¡**ï¼šå¯ç”¨æ“ä½œæ—¥å¿—è®°å½•
6. **æ›´æ–°ä¾èµ–**ï¼šå®šæœŸæ›´æ–°ä¾èµ–ç‰ˆæœ¬

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿï¼š
- é‚®ç®±ï¼šdev@example.com
- æ–‡æ¡£ï¼šæŸ¥çœ‹é¡¹ç›® README.md

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2024-12-15
