<template>
  <page extends="yjpl-template/page/operate/form.yjpl">
    <plugins type="prepend" target=".operate-toolbar">
      <template slot="title">
        列表标题
      </template>
      <template slot="content">
        已选 {{ 12 }} 条
      </template>
      <template slot="content-switch">
        <el-radio-group>
          <el-radio-button :label="0">全部(10)</el-radio-button>
          <el-radio-button :label="1">已完成(5)</el-radio-button>
        </el-radio-group>
      </template>
      <template slot="view-switch">
        <el-radio-group>
          <el-radio-button :label="0">列表</el-radio-button>
          <el-radio-button :label="1">图表</el-radio-button>
        </el-radio-group>
      </template>
    </plugins>

    <plugins type="append" target=".operate-form">
      <div class="operate-slot">
        已选择单位 <span>5</span> 家，<span>120</span> 张报表
        <el-dropdown>
          <i class="el-icon-arrow-down"></i>
          <el-dropdown-menu slot="dropdown">
            <el-dropdown-item>远光软件股份有限公司</el-dropdown-item>
            <el-dropdown-item>远光软件子公司</el-dropdown-item>
            <el-dropdown-item>信创平台部</el-dropdown-item>
          </el-dropdown-menu>
        </el-dropdown>
      </div>
    </plugins>
  </page>
</template>

<script lang="ts">
import QueryFormTemplate from 'yjpl-template/page/query/form.yjpl';
import QueryFormTemplateBs from './form-template';

export default class QueryFormExample extends QueryFormTemplate {
  constructor () {
    super();
    this.bs = new QueryFormTemplateBs();
  }

  data () {
    return {
      ...this.bs.getData(),
      radio: '全部',
      pageModel: {
        title: '操作列表表单样例',
        // 表单列数
        cols: 4,
        // 是否查询表格
        isQueryGrid: true,
        // 工具栏
        toolbar: {
          layout: ['title', 'content', '->','button', 'content-switch', 'view-switch', 'search']
        },
        // 表单区域
        form: [],
        // 表格区域
        grid: {},
        // 按钮区域
        btns: []
      },
      // 用于关联 business 内组件的事件，以组件的 key 为 key
      eventsModel: {
        start: {
          change: this.handleChange
        },
        cancelAudit: {
          click: this.handleCancelAudit
        }
      }
    };
  }

  async created () {
    // 设置组件至对应 pageModel 区域
    this.$pageModel.set('form', ['start', 'units']);
    this.$pageModel.set('grid', 'grid');
    this.$pageModel.set('btns', ['audit', 'cancelAudit', 'export', 'print']);
    this.dataModel.grid = await this.bs.getGridData();
  }
  methods () {
    return {
      handleChange (val) {
        console.log(val);
        if (typeof val !== 'number') {
          this.$nextTick(() => {
            this.dataModel.form.start = '';
          });
        } else if (typeof val === 'string') {
          // 将输入的数字转化成int
          this.$nextTick(() => {
            this.dataModel.form.start = parseInt(val);
          });
        }
      },
      handleAudit () {
        this.$confirm('是否确认审批?', '提示', {
          confirmButtonText: '确定',
          cancelButtonText: '取消',
          type: 'warning'
        }).then(() => {
          this.$message({
            type: 'success',
            message: '审批成功!'
          });
        });
      },
      handleCancelAudit () {
        this.$confirm('是否确认取消审批?', '提示', {
          confirmButtonText: '确定',
          cancelButtonText: '取消',
          type: 'warning'
        }).then(() => {
          this.$message({
            type: 'success',
            message: '取消审批!'
          });
        });
      }
    };
  }
}
</script>

<style lang="scss" scoped>
  .operate-form {
    position: relative;
    font-size: 14px;

    span {
      color: #2663ff;
    }
  }

  .operate-btns {
    margin-right: 20px;
  }

  .operate-slot {
    position: absolute;
    bottom: 22px;
    right: 16px;
  }
</style>
